function addSelectedAttendee(b){var a=$.extend({},b);if(a.person&&a.person>0){if(!$.ListFind(SelectedMembers,a.person,",")){SelectedMembers=$.ListAppend(SelectedMembers,a.person,",")}}if(a.attendee&&a.attendee>0){if(!$.ListFind(SelectedAttendees,a.attendee,",")){SelectedAttendees=$.ListAppend(SelectedAttendees,a.attendee,",")}}updateSelectedCount(1)}function cancelButton(){$("#CreditsDialog").dialog("close")}function clearSelectedMembers(){SelectedAttendees="";SelectedMembers="";SelectedCount=0;$("#CheckedCount").html("(0)")}function removeSelectedPerson(b){var a=$.extend({},b);if(a.person&&a.person>0){SelectedMembers=$.ListDeleteAt(SelectedMembers,$.ListFind(SelectedMembers,a.person))}if(a.attendee&&a.attendee>0){SelectedAttendees=$.ListDeleteAt(SelectedAttendees,$.ListFind(SelectedAttendees,a.attendee))}updateSelectedCount(-1)}function resetAttendee(a,c,b){$.ajax({url:"/AJAX_adm_Activity/resetAttendee",type:"post",data:{attendeeId:c,ActivityID:a,PaymentFlag:b},success:function(d){if(d.STATUS){addMessage(d.STATUSMSG,250,6000,4000);updateStats();updateRegistrants()}else{addError(d.STATUSMSG,250,6000,4000)}}})}function saveAttendee(){$.blockUI({message:"<h1>Adding Attendee...</h1>"});$.post("/AJAX_adm_Activity/saveAttendee",{PersonID:$("#AttendeeID").val(),ActivityID:nActivity,returnFormat:"plain"},function(a){cleanData=$.trim(a);status=$.ListGetAt(cleanData,1,"|");statusMsg=$.ListGetAt(cleanData,2,"|");if(status=="Success"){updateRegistrants(nPageNo,nStatus);addMessage(statusMsg,250,6000,4000);$.unblockUI()}else{if(status=="Fail"){addError(statusMsg,250,6000,4000);$.unblockUI();$("#AttendeeName").val("Click To Add Attendee")}}});$("#AttendeeID").val("");$("#AttendeeName").val("Click To Add Attendee")}function updateAttendeeFilterCounts(){$.each($(".attendees-filter").children(),function(i,item){if($(this).hasClass("attendee-status")){var status=this.id.split("status")[1];var countContainer=$(this).find("span.attendee-status-count");countContainer.html("("+eval("status"+status+"Count")+")")}})}function updatePagesDropdown(){var c=$(".pages");var e=$(".pageSelector");c.children().remove();for(var b=1;b<=totalPages;b++){var a=$("<a />").addClass("page").attr("href","/activities/adm_participants?ActivityID="+nActivity+"&status="+nStatus+"&page="+b).text(b);var d=$("<li />").append(a).appendTo(c)}$(".pageSelector").text(nPageNo);if(nPageNo==1){$("a.previous").addClass("disabled")}if(nPageNo>=totalPages){$("a.next").addClass("disabled")}}function updateRegistrants(b,a){$("#RegistrantsLoading").show();$.ajax({url:"/activity_participants/ahah",type:"get",data:{activityId:nActivity,status:a,selectedAttendees:SelectedAttendees,page:b},success:function(c){$("#RegistrantsContainer").html(c);$("#RegistrantsLoading").hide();$(".AllAttendees").unbind();$(".AllAttendees").isPerson();$(".active-status").remove();$("#status"+a).find("a").prepend('<i class="icon-ok active-status"></i> ');$(".attendee-status-title").text($("#status"+a).find("a span.attendee-status-name").text());if($(".AllAttendees").length==TotalAttendeeCount&&SelectedAttendees.split(",").length==TotalAttendeeCount){$("#CheckAll").attr("checked",true)}$(".AllAttendees").each(function(){$row=$(this);var d=$row.find(".MemberCheckbox");var f=$row.find(".personId").val();var e=$row.find(".attendeeId").val();if($.ListFind(SelectedAttendees,e)){$row.addClass("alert alert-info");d.attr("checked",true)}d.click(function(){if($(this).attr("checked")){$("#attendeeRow-"+e).addClass("alert alert-info");addSelectedAttendee({person:f,attendee:e})}else{$("#attendeeRow-"+e).removeClass("alert alert-info");removeSelectedPerson({person:f,attendee:e})}})})}})}function updateSelectedCount(a){SelectedCount=SelectedCount+a;if(SelectedCount>0){$(".js-partic-actions .btn").removeClass("disabled")}else{$(".js-partic-actions .btn").addClass("disabled")}$("#label-status-selected").text(SelectedCount);$("#statusSelected span.attendee-status-count").text("("+SelectedCount+")")}function updateStatusDate(b,a){$.ajax({url:"/AJAX_adm_Activity/getAttendeeDate",type:"post",data:{AttendeeId:b,type:a},dataType:"json",success:function(c){if(c.STATUS){$("#current-attendee-date-"+b).val(c.PAYLOAD.month+"/"+c.PAYLOAD.day+"/"+c.PAYLOAD.year);$("#current-attendee-status-"+b).val(a);$("#datefill-"+b).html(c.STATUSMSG);$("#editdatelink-"+b).show()}else{addError("test",500,5000,2500)}}})}$(document).ready(function(){var k=$("#remove-attendees");var c=$("#statusSelected");var e=$(".change-status");var l=$(".view-attendee-statusdate");var d=$("#CheckAll");var i=$("#RegistrantsContainer");var b=$(".deleteLink");var g=$("#RegistrantsLoading");var a=$("a.page,a.first,a.last,a.next,a.previous");var f=$(".print");var h=$(".EditStatusDate");var j=$(".attendees-filter li.attendee-status");MaxRegistrants=$("#MaxRegistrants").val();AddlAttendees=$("#AddlAttendees").val();NoChange=0;updateRegistrants(nPageNo,nStatus);l.live("click",function(){var n=this.id.split("-")[1];var m=this.id.split("-")[2];updateStatusDate(n,m);$("#view-attendee-statuses-"+n).find("a .active-status").remove();$(this).prepend('<i class="icon-ok active-status"></i> ')});c.live("click",function(){var m=this.id.split("status")[1];if(SelectedAttendees.length>0){updateRegistrants(1,m)}else{addError("You must select participants first.",500,6000,4000)}});d.live("click",function(){var n=$(".AllAttendees");var m=$(this).attr("checked");n.each(function(){var o=$(this);var p=o.find(".MemberCheckbox");var r=o.find(".personId").val();var q=o.find(".attendeeId").val();var s=p.attr("checked");if(m&&!s){addSelectedAttendee({person:r,attendee:q});p.attr("checked",true);o.addClass("alert alert-info")}else{if(!m&&s){if(s){removeSelectedPerson({person:r,attendee:q});p.attr("checked",false);o.removeClass("alert alert-info")}}}})});b.live("click",function(){var n=$(this).parents(".personRow");var m=n.find(".attendeeId").val();$.ajax({type:"post",dataType:"json",url:"/ajax_adm_activity/removeAttendeeByID",data:{attendeeId:m},async:false,success:function(o){if(o.STATUS){n.remove()}}})});a.live("click",function(){var r=$(".pager-simple a.next");var s=$(".pager-simple a.previous");var n=$(this);var q=$(".pageSelector");var p="/activities/adm_participants?ActivityID=13660&status=0&page=";var m;var o;nPageNo=parseInt($.Mid(this.href,$.Find("page=",this.href)+5,$.Len(this.href)-$.Find("page=",this.href)+4));m=(parseInt(nPageNo)+1);o=(parseInt(nPageNo)-1);if(nPageNo>=1&&nPageNo<=totalPages){if(m<=totalPages){r.attr("href",p+m).removeClass("disabled");passGoCollect$200=true}else{r.attr("href","javascript://");r.addClass("disabled")}if(o>=1){s.attr("href",p+o).removeClass("disabled");passGoCollect$200=true}else{s.attr("href","javascript://");s.addClass("disabled")}q.text(nPageNo);$.post("/UserSettings/setAttendeePage",{ActivityID:nActivity,Page:nPageNo});updateRegistrants(nPageNo,nStatus)}return false});h.live("click",this,function(){var u=this.id;var o=this.id.split("-")[1];var r=$.Trim($("#current-attendee-date-"+o).val());var n;var s=r.split(" ")[0];var t=$("#CancelDate-"+o);var w=$("#edit-attendee-date-"+o);var m=$("#SaveDate-"+o);var v=$("#view-attendee-date-"+o);var p=$("#EditDateField-"+o);$("#CurrStatusDate-"+o).val(r);$("#EditDateField-"+o).val(r);v.hide();w.show();t.click(function(){w.hide();v.show();t.unbind();w.unbind();m.unbind();v.unbind()});p.keydown(function(x){if($.Len($(this).val())>0){n=$(this).val()}if(x.keyCode==13){q($("#EditDateField-"+o).val(),$("#current-attendee-status-"+o).val())}});m.click(function(){q($("#EditDateField-"+o).val(),$("#current-attendee-status-"+o).val())});function q(y,x){if(x!=""&&y.length>0){$.ajax({url:"/AJAX_adm_Activity/saveAttendeeDate",type:"post",data:{attendeeId:o,DateValue:y,Type:x,returnFormat:"plain"},dataType:"json",success:function(z){if(z.STATUS){addMessage(z.STATUSMSG,250,6000,4000);updateRegistrants(nPageNo,nStatus)}else{addError(z.STATUSMSG,250,6000,4000);w.hide();v.show()}}})}else{addError("You must provide full date and time.",250,6000,4000);$("#EditDateField-"+o).focus();$("#EditDateField-"+o).val(n)}}});j.live("click",function(){var n=$(this).find("a");var m=$(this).find("span");nStatus=parseInt(this.id.split("status")[1]);i.html("");g.show();$.ajax({url:"/UserSettings/setAttendeeStatus",type:"post",data:{ActivityID:nActivity,status:nStatus},success:function(o){nPageNo=1;updateRegistrants(nPageNo,nStatus)}});return false});e.live("click",function(n){var m=this.id.split("-")[2];$.ajax({url:"/AJAX_adm_Activity/updateAttendeeStatuses",type:"post",data:{AttendeeList:SelectedAttendees,ActivityID:nActivity,StatusID:m},dataType:"json",success:function(o){if(o.STATUS){addMessage(o.STATUSMSG,500,6000,4000);updateStats();clearSelectedMembers();updateRegistrants(nPageNo,nStatus)}else{addError(o.STATUSMSG,500,6000,4000)}}})});$("#MaxRegistrants,#AddlAttendees").bind("blur",function(){if(MaxRegistrants!=$("#MaxRegistrants").val()){$.post("/AJAX_adm_Activity/updateMaxRegistrants",{ActivityID:nActivity,MaxRegistrants:$("#MaxRegistrants").val(),returnFormat:"plain"},function(m){cleanData=$.trim(m);status=$.ListGetAt(cleanData,1,"|");statusMsg=$.ListGetAt(cleanData,2,"|");if(status=="Success"){addMessage(statusMsg,250,6000,4000)}else{addError(statusMsg,250,6000,4000)}});MaxRegistrants=$("#MaxRegistrants").val()}else{NoChange=NoChange+1}if(AddlAttendees!=$("#AddlAttendees").val()){$.post("/AJAX_adm_Activity/updateAddlAttendees",{ActivityID:nActivity,AddlAttendees:$("#AddlAttendees").val(),returnFormat:"plain"},function(m){cleanData=$.trim(m);status=$.ListGetAt(cleanData,1,"|");statusMsg=$.ListGetAt(cleanData,2,"|");if(status=="Success"){addMessage(statusMsg,250,6000,4000)}else{addError(statusMsg,250,6000,4000)}});AddlAttendees=$("#AddlAttendees").val()}else{NoChange=NoChange+1}if(NoChange==2){addError("Please adjust the value you want to update and try again.",250,6000,4000);NoChange=0}else{if(NoChange>0){NoChange=0}}});k.live("click",function(){var m="";if(SelectedAttendees.length>0){if(confirm("Are you sure you want to remove the checked attendees from this activity?")){$.blockUI({message:"<h1>Removing Selected Attendees...</h1>"});$.ajax({url:"/AJAX_adm_Activity/removeCheckedAttendees",type:"post",data:{PersonList:SelectedMembers,AttendeeList:SelectedAttendees,ActivityID:nActivity,returnFormat:"plain"},dataType:"json",success:function(n){if(n.STATUS){addMessage(n.STATUSMSG,250,6000,4000);clearSelectedMembers()}else{addError(n.STATUSMSG,250,6000,4000)}updateStats();$.unblockUI();updateRegistrants(nPageNo,nStatus)}})}}else{addError("You must select attendees to remove.",500,3000,2500)}});f.live("click",function(){var m=this.id.split("-")[1];switch(m){case"cme":if(SelectedAttendees.length>0){window.open("/report/CMECert?ActivityID="+nActivity+"&ReportID=5&selectedAttendees="+SelectedAttendees)}else{window.open("/report/CMECert?ActivityID="+nActivity+"&ReportID=5")}break;case"cne":if(SelectedAttendees.length>0){window.open("/report/CNECert?ActivityID="+nActivity+"&ReportID=6&selectedAttendees="+SelectedAttendees)}else{window.open("/report/CNECert?ActivityID="+nActivity+"&ReportID=6")}break}})});
